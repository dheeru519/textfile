import java.io.File
pipeline 
{
    agent any 
    options { 
        disableConcurrentBuilds() 
        buildDiscarder(logRotator(numToKeepStr: '20', daysToKeepStr: '10'))
    }
    parameters {
        string(name: 'BuildNo', defaultValue: '1.0.$BUILD_NUMBER.0', description: 'Build Number')
    }
    stages { 
        stage("Set Build Name") {
            steps 
            {
                script {
                    currentBuild.displayName = "1.0.${BUILD_NUMBER}.0" 
		    def scmVars = checkout scm
  		    echo 'scm : the commit id is ' +scmVars.GIT_COMMIT
 		    echo 'scm : the commit branch  is ' +scmVars.GIT_BRANCH
  	            echo 'scm : the previous commit id is ' +scmVars.GIT_PREVIOUS_COMMIT
                }
            }
        }	
        stage('Info File Creation') {
		steps {
			script
				{
				  	dir("Common")
					{
						bat 'echo %BuildNo% > Info.txt'
						powershell '''ForEach-Object { Add-Content -Path ".\\Info.txt" -Value "Calculation Engine Version: $env:BUILD_NUMBER","Github Repository: $env:GIT_URL","Branch: $env:GIT_BRANCH" }'''			
						bat label: '', returnStdout: true, script: 'git log -1' >> Info.txt'	
						def file = readFile('Info.txt')
						echo "file:$file"
						def JOB_Details = file.readLines()
						echo "JOB_Details:$JOB_Details" 
						powershell '''Get-Content -Path ".\\Info.txt"'''
							 
         				}
			}	
		   
    		}
	}

   /* post {      
            success {
                archiveArtifacts 'common\\wise scripts\\*.exe'
		 
                emailext attachLog: true, body: '$DEFAULT_CONTENT', recipientProviders: [developers(), requestor()], replyTo: '$DEFAULT_REPLYTO', subject: '$DEFAULT_SUBJECT', to: 'Vijay.Bojjagani@carrier.com,Robert.Howe@carrier.com,Achalu.K.Tirfe@Carrier.com'

            }
          	 failure {
                emailext attachLog: true, body: '$DEFAULT_CONTENT', recipientProviders: [developers(), requestor()], replyTo: '$DEFAULT_REPLYTO', subject: '$DEFAULT_SUBJECT', to: 'shiva.kirla@carrier.com,Vijay.Bojjagani@carrier.com,Robert.Howe@carrier.com,Achalu.K.Tirfe@Carrier.com'
            	} 
    } */
}
}
