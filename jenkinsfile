pipeline 
{
	agent any

	parameters 
  	{
    		string(name: 'MasterBuildNo', defaultValue: '1.0.$BUILD_NUMBER.0', description: 'Master Build Number ')
     		string(name: 'BuildNo', defaultValue: '1.0.$BUILD_NUMBER.0', description: 'Build Number ') 
 
    	}
 
  	stages {
  
   //Set master build name
            stage("Set Master Build Name") {
               steps {
                     script {
                           currentBuild.displayName=MasterBuildNo

                           echo "BuildNo: ${BuildNo}"           

                     }
              stage("GIT INFO") {
    				echo ":::::::::::GIT_SHORT_COMMIT::::::::::::::::::::::::"

   				 GIT_SHORT_COMMIT = sh(returnStdout: true, script: "git log -n 1 --pretty=format:'%h'").trim()
    //echo in jenkins console
  				  echo GIT_SHORT_COMMIT
    //wanted to send these info to build artifacts, append to any file
  				  sh("echo ${GIT_SHORT_COMMIT} > GIT_SHORT_COMMIT")

    //Similar proceed for other git info's 
  				  echo ":::::::::::GIT_COMMITTER_EMAIL::::::::::::::::::::::::"

   					 GIT_COMMITTER_EMAIL = sh(returnStdout: true, script: "git show -s --pretty=%ae").trim()
   					 sh("echo ${GIT_COMMITTER_EMAIL} > GIT_COMMITTER_EMAIL-${GIT_COMMITTER_EMAIL}")



   						 echo ":::::::::::GIT_COMMITTER_NAME::::::::::::::::::::::::"

    						GIT_COMMITTER_NAME = sh(returnStdout: true, script: "git show -s --pretty=%an").trim()
  						  sh("echo ${GIT_COMMITTER_NAME} > GIT_COMMITTER_NAME-${GIT_COMMITTER_NAME}")
  		}
             
	      }
            }   
	    
	     stage('Info File Creation') {
			      steps {
			      	
				      bat '''mkdir "C:\\Jenkins\\.jenkins\\workspace\\jenkinsfilecreation\\JenkinsOutput\\%BuildNo%"'''
				      
					
				      bat 'echo %BuildNo% > Info.txt'		
				
				      powershell 'Get-Date| Add-Content -Path C:\\Jenkins\\.jenkins\\workspace\\jenkinsfilecreation\\JenkinsOutput\\$env:BUILD_NUMBER\\Info.txt'
				
				      powershell '''ForEach-Object { Add-Content -Path "C:\\Jenkins\\.jenkins\\workspace\\jenkinsfilecreation\\JenkinsOutput\\$env:BUILD_NUMBER\\Info.txt" -Value "Calculation Engine Version: $env:BUILD_NUMBER","Author: $env:GIT_AUTHOR_NAME","Author Email: $GIT_COMMITTER_EMAIL","Github Repository: $env:GIT_URL","Commit Version: $env:GIT_COMMIT","Branch: $env:GIT_BRANCH" }'''
				
				      powershell '$UtcTime = Get-Date'
				
				      powershell '$UtcTime.ToUniversalTime()'
				
				      powershell '$UtcTime.ToUniversalTime() >> C:\\Jenkins\\.jenkins\\workspace\\jenkinsfilecreation\\JenkinsOutput\\$env:BUILD_NUMBER\\Info.txt'
				
				      powershell 'timestamp {"Date: $(Get-Date -Format G)"} >> C:\\Jenkins\\.jenkins\\workspace\\jenkinsfilecreation\\JenkinsOutput\\$env:BUILD_NUMBER\\Info.txt'
				
				      powershell '''Get-Content -Path "C:\\Jenkins\\.jenkins\\workspace\\jenkinsfilecreation\\JenkinsOutput\\$env:BUILD_NUMBER\\Info.txt"'''
			      }
	         }	
  	}
 }
